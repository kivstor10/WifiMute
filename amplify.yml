version: 1
backend:
  phases:
    install:
      runtime-versions:
        nodejs: 22
      commands:
        - echo "--- BEGINNING OF BACKEND INSTALL PHASE COMMANDS ---"
        - echo "Initial node version check:"
        - node -v # Check here
        - which node # Check here

        # ... (your existing commands) ...

        - echo "Node.js version after nvm use 22:"
        - node -v # VERIFY: This should print v22.x.x
        - which node # VERIFY: This should show the nvm path for node 22
        - npm -v

        # ... (rest of your backend install phase) ...

    build:
      commands:
        - echo "Node.js version at beginning of backend build phase:"
        - node -v # Check here
        - which node # Check here
        - npx ampx pipeline-deploy --branch $AWS_BRANCH --app-id $AWS_APP_ID
        - echo "Amplify backend deployment command executed."

frontend:
  phases:
    build:
      commands:
        - echo "--- BEGINNING OF FRONTEND BUILD PHASE COMMANDS ---"
        - echo "Node.js version at beginning of frontend build phase:"
        - node -v # Check here
        - which node # Check here
        - npm ci --cache .npm --prefer-offline
        - echo "Frontend npm ci completed within build phase."

        - npm run build
        - echo "Frontend build command executed."
        - echo "--- END OF FRONTEND BUILD PHASE COMMANDS ---"
artifacts:
  baseDirectory: dist
  files:
    - '**/*'
cache:
  paths:
    - .npm/**/*
    - node_modules/**/*