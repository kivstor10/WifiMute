version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Install frontend dependencies
        - npm ci
        # Install the Amplify Gen 2 backend CLI package locally within the build environment.
        - npm install @aws-amplify/backend-cli
    build:
      commands:
        # Deploy the Amplify Gen 2 backend using the correct pipeline deploy command.
        # Pass the required --branch and --app-id arguments from environment variables.
        - npx @aws-amplify/backend-cli pipeline-deploy --branch $AMPLIFY_BRANCH --app-id $AMPLIFY_APP_ID
        # Build your frontend application.
        - npm run build
  artifacts:
    # Adjust 'baseDirectory' based on your frontend framework:
    baseDirectory: dist # <--- **ADJUST THIS BASED ON YOUR FRONTEND FRAMEWORK**
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*