version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Install frontend dependencies
        - npm ci
        # Install the Amplify Gen 2 backend CLI package locally within the build environment.
        # This ensures the 'deploy' command is available as 'npx @aws-amplify/backend-cli deploy'.
        - npm install @aws-amplify/backend-cli
    build:
      commands:
        # Deploy the Amplify Gen 2 backend using the correct package.
        # --host tells it to deploy to the Amplify Hosting backend environment.
        # This command will also generate amplify_outputs.json.
        - npx @aws-amplify/backend-cli deploy --host
        # Build your frontend application.
        # This command will use amplify_outputs.json generated by the deploy step.
        - npm run build
  artifacts:
    # Adjust 'baseDirectory' based on your frontend framework:
    # - For Create React App: build
    # - For Next.js: .next
    # - For Vue.js (Vite/Vue CLI): dist
    # - For Angular: dist/your-project-name
    baseDirectory: dist # <--- **ADJUST THIS BASED ON YOUR FRONTEND FRAMEWORK**
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*