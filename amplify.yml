version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Ensure a clean install and correct package versions
        - rm -rf node_modules
        - rm -f package-lock.json yarn.lock
        - npm install --unsafe-perm=true
        # (Optional: keep these lines if you want to be extra sure about specific @aws-amplify packages)
        # - npm install @aws-amplify/backend@latest @aws-amplify/backend-data@latest @aws-amplify/backend-cli@latest
    build:
      commands:
        # THIS IS THE LINE TO CHANGE:
        - npx ampx pipeline-deploy --branch $AMPLIFY_BRANCH --app-id $AMPLIFY_APP_ID
        # If you have a frontend build command, it would go here (e.g., npm run build)
    postBuild:
      commands:
        # Any post-build steps
  artifacts:
    baseDirectory: . # Or your frontend build output directory (e.g., build, dist)
    files:
      - '**/*'